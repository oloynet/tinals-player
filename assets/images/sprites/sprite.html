<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualiseur des sprites SVG</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            padding-bottom: 50px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        h2 {
            text-align: center;
            font-size: 1rem;
            color: #7f8c8d;
            font-weight: normal;
            margin-top: -20px;
            margin-bottom: 30px;
        }
        .validation-box {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .validation-box pre {
            margin: 0;
            padding: 15px;
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            font-size: 0.9em;
            background-color: #fcfcfc;
            color: #333;
        }
        .validation-box .error {
            color: #d8000c;
            font-weight: bold;
        }
        .validation-box .warning {
            color: #9f6000;
            font-weight: bold;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .preview {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .checkerboard {
            background-color: #eee;
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc),
                linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }
        .preview svg {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            border: 1px dotted #333;
        }
        .info {
            padding: 15px;
            background: #fff;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .info h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            word-break: break-all;
            color: #34495e;
        }
        .info p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
        .info strong {
            color: #333;
        }
        .actions {
            margin-top: 10px;
            text-align: center;
        }
        .btn-download {
            display: inline-block;
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.85em;
            transition: background-color 0.2s;
            margin: 0 5px;
        }
        .btn-download:hover {
            background-color: #2980b9;
        }
        .footer-link {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .footer-link a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        .footer-link a:hover {
            text-decoration: underline;
        }


        .svg-tag-tinals-2026,
        .svg-tag-tinals-2026-dark {
            fill: var(--primary-color);
        }

        .svg-deezer,
        .svg-deezer-icon {
            fill: #000;
        }
        .svg-deezer-dark,
        .svg-deezer-icon-dark {
            fill: #fff;
        }

        .svg-facebook,
        .svg-facebook-icon,
        .svg-facebook-dark,
        .svg-facebook-icon-dark {
            fill: #0866ff;
        }

        .svg-instagram,
        .svg-instagram-icon {
            fill: #262626;
        }

        .svg-instagram-dark,
        .svg-instagram-icon-dark {
            fill: #fff;
        }

        .svg-pinterest-icon,
        .svg-pinterest-icon-dark {
            fill: #e71c26;
        }

        .svg-soundcloud-icon,
        .svg-soundcloud-icon-dark {
            fill: #ff5500;
        }

        .svg-spotify,
        .svg-spotify-icon,
        .svg-spotify-dark,
        .svg-spotify-icon-dark {
            fill: #1ed760;
            fill: #1ed760;
        }

        .svg-tiktok,
        .svg-tiktok-icon {
            fill: #000;
        }
        .svg-tiktok-dark,
        .svg-tiktok-icon-dark {
            fill: #fff;
        }

        .svg-youtube,
        .svg-youtube-icon {
            fill: #212121;
        }
        .svg-youtube-dark,
        .svg-youtube-icon-dark {
            fill: #fff;
        }

    </style>
</head>
<body>
    <h1>Visualiseur des sprites SVG</h1>
    <h2 id="file-path">Fichier : sprite.svg</h2>

    <div id="validation-errors" class="validation-box" style="display: none;">
        <pre></pre>
    </div>

    <div id="grid" class="grid"></div>

    <div class="footer-link">
        <a href="https://svgomg.net/" target="_blank">Optimiser vos SVG avec SVGOMG</a>
    </div>

    <script>
        function validateSVG(text) {
            const lines = text.split('\n');
            const errors = [];
            const ids = new Set();
            let inSymbol = false;
            let currentSymbolId = null;
            let hasTitle = false;
            let symbolStartLine = 0;

            // XML Parse Check
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'image/svg+xml');
            const parserError = doc.querySelector('parsererror');
            if (parserError) {
                errors.push({
                    line: 1,
                    type: 'Erreur Critique',
                    msg: 'Le fichier SVG est malformé (XML invalide).',
                    content: parserError.textContent
                });
                return errors;
            }

            // Line-by-line analysis
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const lineNum = i + 1;

                // Detection of <symbol> tag start
                if (line.match(/<symbol/)) {
                    inSymbol = true;
                    symbolStartLine = lineNum;
                    hasTitle = false;

                    // Handle attributes spread across multiple lines
                    let tagContent = line;
                    let offset = 0;
                    // Aggregate lines until we find the closing bracket of the opening tag
                    while (!tagContent.includes('>') && (i + offset + 1) < lines.length) {
                        offset++;
                        tagContent += ' ' + lines[i + offset];
                    }

                    // Basic attribute extraction using Regex
                    const idMatch = tagContent.match(/id="([^"]*)"/);
                    const viewBoxMatch = tagContent.match(/viewBox="([^"]*)"/);
                    const ariaLabelMatch = tagContent.match(/aria-label="([^"]*)"/);

                    const id = idMatch ? idMatch[1] : null;
                    currentSymbolId = id;

                    // Validation Rules
                    if (!id) {
                        errors.push({ line: lineNum, type: 'Erreur', msg: 'Attribut "id" manquant sur <symbol>.', content: line.trim() });
                    } else {
                        if (ids.has(id)) {
                            errors.push({ line: lineNum, type: 'Erreur', msg: `ID dupliqué : "${id}".`, content: line.trim() });
                        }
                        ids.add(id);
                    }

                    if (!viewBoxMatch) {
                        errors.push({ line: lineNum, type: 'Erreur', msg: `Attribut "viewBox" manquant pour "${id || 'symbol'}".`, content: line.trim() });
                    }

                    if (!ariaLabelMatch) {
                        errors.push({ line: lineNum, type: 'Avertissement', msg: `Attribut "aria-label" manquant pour "${id || 'symbol'}".`, content: line.trim() });
                    }
                }

                if (inSymbol) {
                    if (line.match(/<title>/)) {
                        hasTitle = true;
                        if (line.match(/<title>\s*<\/title>/)) {
                             errors.push({ line: lineNum, type: 'Avertissement', msg: `Balise <title> vide pour "${currentSymbolId || 'symbol'}".`, content: line.trim() });
                        }
                    }

                    if (line.match(/<\/symbol>/)) {
                        if (!hasTitle) {
                            errors.push({ line: symbolStartLine, type: 'Avertissement', msg: `Balise <title> manquante pour "${currentSymbolId || 'symbol'}".`, content: lines[symbolStartLine-1].trim() });
                        }
                        inSymbol = false;
                        currentSymbolId = null;
                    }
                }
            }
            return errors;
        }

        function displayValidationErrors(errors) {
            const container = document.getElementById('validation-errors');
            const pre = container.querySelector('pre');

            if (errors.length === 0) return;

            container.style.display = 'block';
            container.style.borderLeft = errors.some(e => e.type.includes('Erreur')) ? '5px solid #d8000c' : '5px solid #9f6000';

            let output = '<strong>Rapport de validation :</strong>\n\n';
            errors.forEach(err => {
                const typeClass = err.type.includes('Erreur') ? 'error' : 'warning';
                output += `<span class="${typeClass}">[Ligne ${err.line}] ${err.type} : ${err.msg}</span>\n`;
                if (err.content) {
                    // Escape HTML for display
                    const safeContent = err.content.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    output += `    Code : ${safeContent.substring(0, 150)}${safeContent.length > 150 ? '...' : ''}\n`;
                }
                output += '\n';
            });
            pre.innerHTML = output;
        }

        document.addEventListener('DOMContentLoaded', () => {

            const color = '-dark'; // '' for light background or '-dark' for dark background;

            const timestamp = new Date().getTime();
            const filePath  = 'sprite.svg'; // Chemin du fichier relatif
            document.getElementById('file-path').innerText = `Fichier : ${window.location.pathname.replace('sprite.html', '')}${filePath}`;

            fetch(`${filePath}?t=${timestamp}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur réseau ou fichier non trouvé');
                    }
                    return response.text();
                })
                .then(text => {
                    // Validation
                    const validationErrors = validateSVG(text);
                    displayValidationErrors(validationErrors);

                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'image/svg+xml');
                    const symbols = doc.querySelectorAll('symbol');
                    const container = document.getElementById('grid');

                    if (symbols.length === 0) {
                        container.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Aucun symbole trouvé dans le fichier sprite.svg</p>';
                        return;
                    }

                    symbols.forEach(symbol => {
                        const id        = symbol.id;
                        const ariaLabel = symbol.getAttribute('aria-label') || '<em>Non défini</em>';
                        const viewBox   = symbol.getAttribute('viewBox');

                        // Récupération Title et Desc
                        const titleEl = symbol.querySelector('title');
                        const descEl  = symbol.querySelector('desc');
                        const title   = titleEl ? titleEl.textContent : '<em>Non défini</em>';
                        const desc    = descEl  ? descEl.textContent  : '<em>Non défini</em>';

                        let dimensions = 'Non défini';
                        if (viewBox) {
                            const parts = viewBox.split(/[ ,]+/);
                            if (parts.length === 4) {
                                dimensions = `${parts[2]} x ${parts[3]}`;
                            } else {
                                dimensions = viewBox;
                            }
                        }

                        // Création du SVG blob pour le téléchargement
                        // On crée un SVG enveloppant avec le contenu du symbole
                        const svgContent = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="${viewBox || '0 0 100 100'}">
${symbol.innerHTML}
</svg>`;
                        const blob = new Blob([svgContent], {type: 'image/svg+xml'});
                        const url = URL.createObjectURL(blob);

                        // Création de la carte
                        const card = document.createElement('div');
                        card.className = 'card';

                        card.innerHTML = `
                            <div class="preview checkerboard">
                                <svg viewBox="${viewBox || ''}" class="svg-${id}${color}">
                                    <use href="${filePath}?t=${timestamp}#${id}"></use>
                                </svg>
                            </div>
                            <div class="info">
                                <h3>${id}</h3>
                                <p><strong>Label :</strong> ${ariaLabel}</p>
                                <p><strong>Title :</strong> ${title}</p>
                                <p><strong>Desc :</strong> ${desc}</p>
                                <p><strong>Dimensions :</strong> ${dimensions}</p>
                                <div class="actions">
                                    <a href="${url}" target="_blank" class="btn-download">Voir SVG</a>
                                    <a href="${url}" download="${id}.svg" target="_blank" class="btn-download">Télécharger SVG</a>
                                </div>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error('Erreur lors du chargement du sprite :', err);
                    document.getElementById('grid').innerHTML = `<p style="text-align:center; color:red; grid-column: 1/-1;">Erreur : ${err.message}.<br>Assurez-vous que cette page est servie via un serveur web (http://localhost...) et que le fichier sprite.svg est présent.</p>`;
                });
        });
    </script>
</body>
</html>
