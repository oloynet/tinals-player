<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualiseur des sprites SVG</title>
    <style>
        :root {
            --primary-color:    #e9552b;  /* orange - rgb(255, 65, 4) */
            --secondary-color:  #ffa7b5;  /* pink */
            --third-color:      #2d91d0;  /* blue */
            --fourth-color:     #f8f8d8;  /* light yellow */
            --fifth-color:      #96a002;  /* green */

            --black-color:      #000;
            --white-color:      #fff;

            --deezer-orange-color:       #a238ff;
            --facebook-blue-color:       #0766ff;
            --instagram-dark-grey-color: #262626;
            --pinterest-red-color:       #e71c26;
            --soundcloud-orange-color:   #f50;
            --spotify-green-color:       #1ed760;
            --tiktok-blue-color:         #25F4EE;
            --tiktok-red-color:          #FE2C55;
            --youtube-dark-grey-color:   #212121;
            --youtube-red-color:         #f03;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            padding-bottom: 50px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #f0f0f0;
        }
        body.dark-mode h1 {
            color: #ecf0f1;
        }
        body.dark-mode h2 {
            color: #bdc3c7;
        }
        body.dark-mode .card {
            background-color: #2c3e50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        body.dark-mode .info {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        body.dark-mode .info h3 {
            color: #ecf0f1;
        }
        body.dark-mode .info p {
            color: #bdc3c7;
        }
        body.dark-mode .info strong {
            color: #fff;
        }
        body.dark-mode .validation-box {
            background-color: #2c3e50;
            border-color: #444;
        }
        body.dark-mode .validation-box pre {
            background-color: #252525;
            color: #f0f0f0;
        }
        body.dark-mode .footer-link a {
            color: #5dade2;
        }
        body.dark-mode .preview {
            border-bottom: 1px solid #444;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        h2 {
            text-align: center;
            font-size: 1rem;
            color: #7f8c8d;
            font-weight: normal;
            margin-top: -20px;
            margin-bottom: 30px;
        }
        .validation-box {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .validation-box pre {
            margin: 0;
            padding: 15px;
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            font-size: 0.9em;
            background-color: #fcfcfc;
            color: #333;
        }
        .validation-box .error {
            color: #d8000c;
            font-weight: bold;
        }
        .validation-box .warning {
            color: #9f6000;
            font-weight: bold;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s;
        }
        .preview {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .checkerboard {
            background-color: #eee;
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc),
                linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        body.dark-mode .checkerboard {
            background-color: #333;
            background-image:
                linear-gradient(45deg, #444 25%, transparent 25%, transparent 75%, #444 75%, #444),
                linear-gradient(45deg, #444 25%, transparent 25%, transparent 75%, #444 75%, #444);
        }

        .preview svg {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            border: 1px dotted #333;
        }

        body.dark-mode .preview svg {
             border: 1px dotted #777;
        }

        .info {
            padding: 15px;
            background: #fff;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, color 0.3s;
        }
        .info h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            word-break: break-all;
            color: #34495e;
        }
        .info p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
        .info strong {
            color: #333;
        }
        .actions {
            margin-top: 10px;
            text-align: center;
        }
        .btn-download {
            display: inline-block;
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.85em;
            transition: background-color 0.2s;
            margin: 0 5px;
        }
        .btn-download:hover {
            background-color: #2980b9;
        }
        .footer-link {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .footer-link a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }
        .footer-link a:hover {
            text-decoration: underline;
        }

        /* Toggle Button */
        #theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        #theme-toggle:hover {
            background-color: #2980b9;
        }

    /* --- SVG COLORS SPRITES--- */

        .svg-logo-tinals-2026,
        .svg-tag-tinals-2026,
        .svg-svg-logo-paloma-2012,
        .svg-logo-paloma-2022,
        .svg-logo-nimes-metropole,
        .svg-logo-come-on-people {
            fill: var(--black-color);
        }

        .svg-logo-tinals-2026-dark,
        .svg-tag-tinals-2026-dark,
        .svg-svg-logo-paloma-2012-dark,
        .svg-logo-paloma-2022-dark,
        .svg-logo-nimes-metropole-dark,
        .svg-logo-come-on-people-dark {
            fill: var(--white-color);
        }

        .svg-logo-tinals-2026-primary,
        .svg-tag-tinals-2026-primary,
        .svg-svg-logo-paloma-2012-primary,
        .svg-logo-paloma-2022-primary,
        .svg-logo-nimes-metropole-primary,
        .svg-logo-come-on-people-primary {
            fill: var(--primary-color);
        }

        .svg-deezer,
        .svg-deezer-icon {
            fill: var(--black-color);
        }
        .svg-deezer-dark,
        .svg-deezer-icon-dark {
            fill: var(--white-color);
        }

        .svg-facebook,
        .svg-facebook-icon,
        .svg-facebook-dark,
        .svg-facebook-icon-dark {
            fill: var(--facebook-blue-color);
        }

        .svg-instagram,
        .svg-instagram-icon {
            fill: var(--instagram-dark-grey-color);
        }

        .svg-instagram-dark,
        .svg-instagram-icon-dark {
            fill: var(--white-color);
        }

        .svg-pinterest-icon,
        .svg-pinterest-icon-dark {
            fill: var( --pinterest-red-color);
        }

        .svg-soundcloud-icon,
        .svg-soundcloud-icon-dark {
            fill: var(--soundcloud-orange-color);
        }

        .svg-spotify,
        .svg-spotify-icon,
        .svg-spotify-dark,
        .svg-spotify-icon-dark {
            fill: var(--spotify-green-color);
        }

        .svg-tiktok,
        .svg-tiktok-icon {
            fill: var(--black-color);
        }
        .svg-tiktok-dark,
        .svg-tiktok-icon-dark {
            fill: var(--white-color);
        }

        .svg-youtube,
        .svg-youtube-icon {
            fill: var(--youtube-dark-grey-color);
        }
        .svg-youtube-dark,
        .svg-youtube-icon-dark {
            fill: var(--white-color);
        }

    </style>
</head>
<body>
    <button id="theme-toggle">Mode Sombre</button>
    <h1>Visualiseur des sprites SVG</h1>
    <h2 id="file-path">Fichier : sprite.svg</h2>

    <div id="validation-errors" class="validation-box" style="display: none;">
        <pre></pre>
    </div>

    <div id="grid" class="grid"></div>

    <div class="footer-link">
        <a href="https://svgomg.net/" target="_blank">Optimiser vos SVG avec SVGOMG</a>
    </div>

    <script>
        function validateSVG(text) {
            const lines = text.split('\n');
            const errors = [];
            const ids = new Set();
            let inSymbol = false;
            let currentSymbolId = null;
            let hasTitle = false;
            let symbolStartLine = 0;

            // XML Parse Check
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'image/svg+xml');
            const parserError = doc.querySelector('parsererror');
            if (parserError) {
                errors.push({
                    line: 1,
                    type: 'Erreur Critique',
                    msg: 'Le fichier SVG est malformé (XML invalide).',
                    content: parserError.textContent
                });
                return errors;
            }

            // Line-by-line analysis
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const lineNum = i + 1;

                // Detection of <symbol> tag start
                if (line.match(/<symbol/)) {
                    inSymbol = true;
                    symbolStartLine = lineNum;
                    hasTitle = false;

                    // Handle attributes spread across multiple lines
                    let tagContent = line;
                    let offset = 0;
                    // Aggregate lines until we find the closing bracket of the opening tag
                    while (!tagContent.includes('>') && (i + offset + 1) < lines.length) {
                        offset++;
                        tagContent += ' ' + lines[i + offset];
                    }

                    // Basic attribute extraction using Regex
                    const idMatch = tagContent.match(/id="([^"]*)"/);
                    const viewBoxMatch = tagContent.match(/viewBox="([^"]*)"/);
                    const ariaLabelMatch = tagContent.match(/aria-label="([^"]*)"/);

                    const id = idMatch ? idMatch[1] : null;
                    currentSymbolId = id;

                    // Validation Rules
                    if (!id) {
                        errors.push({ line: lineNum, type: 'Erreur', msg: 'Attribut "id" manquant sur <symbol>.', content: line.trim() });
                    } else {
                        if (ids.has(id)) {
                            errors.push({ line: lineNum, type: 'Erreur', msg: `ID dupliqué : "${id}".`, content: line.trim() });
                        }
                        ids.add(id);
                    }

                    if (!viewBoxMatch) {
                        errors.push({ line: lineNum, type: 'Erreur', msg: `Attribut "viewBox" manquant pour "${id || 'symbol'}".`, content: line.trim() });
                    }

                    if (!ariaLabelMatch) {
                        errors.push({ line: lineNum, type: 'Avertissement', msg: `Attribut "aria-label" manquant pour "${id || 'symbol'}".`, content: line.trim() });
                    }
                }

                if (inSymbol) {
                    if (line.match(/<title>/)) {
                        hasTitle = true;
                        if (line.match(/<title>\s*<\/title>/)) {
                             errors.push({ line: lineNum, type: 'Avertissement', msg: `Balise <title> vide pour "${currentSymbolId || 'symbol'}".`, content: line.trim() });
                        }
                    }

                    if (line.match(/<\/symbol>/)) {
                        if (!hasTitle) {
                            errors.push({ line: symbolStartLine, type: 'Avertissement', msg: `Balise <title> manquante pour "${currentSymbolId || 'symbol'}".`, content: lines[symbolStartLine-1].trim() });
                        }
                        inSymbol = false;
                        currentSymbolId = null;
                    }
                }
            }
            return errors;
        }

        function displayValidationErrors(errors) {
            const container = document.getElementById('validation-errors');
            const pre = container.querySelector('pre');

            if (errors.length === 0) return;

            container.style.display = 'block';
            container.style.borderLeft = errors.some(e => e.type.includes('Erreur')) ? '5px solid #d8000c' : '5px solid #9f6000';

            let output = '<strong>Rapport de validation :</strong>\n\n';
            errors.forEach(err => {
                const typeClass = err.type.includes('Erreur') ? 'error' : 'warning';
                output += `<span class="${typeClass}">[Ligne ${err.line}] ${err.type} : ${err.msg}</span>\n`;
                if (err.content) {
                    // Escape HTML for display
                    const safeContent = err.content.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    output += `    Code : ${safeContent.substring(0, 150)}${safeContent.length > 150 ? '...' : ''}\n`;
                }
                output += '\n';
            });
            pre.innerHTML = output;
        }

        document.addEventListener('DOMContentLoaded', () => {

            let classColorExt = ''; // '' for light background or '-dark' for dark background;
            const themeToggleBtn = document.getElementById('theme-toggle');

            // Theme Management
            function setTheme(isDark) {
                if (isDark) {
                    document.body.classList.add('dark-mode');
                    themeToggleBtn.innerText = 'Mode Clair';
                    classColorExt = '-dark';
                } else {
                    document.body.classList.remove('dark-mode');
                    themeToggleBtn.innerText = 'Mode Sombre';
                    classColorExt = '';
                }

                console.log( 'classColorExt = ' + classColorExt );

                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                updateSvgClasses();
            }

            function updateSvgClasses() {
                const svgs = document.querySelectorAll('.card .preview svg[data-id]');
                svgs.forEach(svg => {
                    const id = svg.getAttribute('data-id');
                    svg.setAttribute('class', `svg-${id}${classColorExt}`);
                });
            }

            themeToggleBtn.addEventListener('click', () => {
                const isDark = !document.body.classList.contains('dark-mode');
                setTheme(isDark);
            });

            // Initialize theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                setTheme(true);
            }

            const timestamp  = new Date().getTime();
            const filePath   = 'sprite.svg'; // Chemin du fichier relatif

            document.getElementById('file-path').innerText = `Fichier : ${window.location.pathname.replace('sprite.html', '')}${filePath}`;

            fetch(`${filePath}?t=${timestamp}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur réseau ou fichier non trouvé');
                    }
                    return response.text();
                })
                .then(text => {
                    // Validation
                    const validationErrors = validateSVG(text);
                    displayValidationErrors(validationErrors);

                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'image/svg+xml');
                    const symbols = doc.querySelectorAll('symbol');
                    const container = document.getElementById('grid');

                    if (symbols.length === 0) {
                        container.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Aucun symbole trouvé dans le fichier sprite.svg</p>';
                        return;
                    }

                    symbols.forEach(symbol => {
                        const id        = symbol.id;
                        const ariaLabel = symbol.getAttribute('aria-label') || '<em>Non défini</em>';
                        const viewBox   = symbol.getAttribute('viewBox');

                        // Récupération Title et Desc
                        const titleEl = symbol.querySelector('title');
                        const descEl  = symbol.querySelector('desc');
                        const title   = titleEl ? titleEl.textContent : '<em>Non défini</em>';
                        const desc    = descEl  ? descEl.textContent  : '<em>Non défini</em>';

                        let dimensions = 'Non défini';
                        if (viewBox) {
                            const parts = viewBox.split(/[ ,]+/);
                            if (parts.length === 4) {
                                dimensions = `${parts[2]} x ${parts[3]}`;
                            } else {
                                dimensions = viewBox;
                            }
                        }

                        // Création du SVG blob pour le téléchargement
                        // On crée un SVG enveloppant avec le contenu du symbole
                        const svgContent = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="${viewBox || '0 0 100 100'}">
${symbol.innerHTML}
</svg>`;
                        const blob = new Blob([svgContent], {type: 'image/svg+xml'});
                        const url = URL.createObjectURL(blob);

                        // Création de la carte
                        const card = document.createElement('div');
                        card.className = 'card';

                        const classColor = `svg-${id}${classColorExt}`;

                        card.innerHTML = `
                            <div class="preview checkerboard">
                                <svg viewBox="${viewBox || ''}" class="${classColor}" data-id="${id}">
                                    <use href="${filePath}?t=${timestamp}#${id}"></use>
                                </svg>
                            </div>
                            <div class="info">
                                <h3>${id}</h3>
                                <p><strong>Label :</strong> ${ariaLabel}</p>
                                <p><strong>Title :</strong> ${title}</p>
                                <p><strong>Desc :</strong> ${desc}</p>
                                <p><strong>Dimensions :</strong> ${dimensions}</p>
                                <div class="actions">
                                    <a href="${url}" target="_blank" class="btn-download">Voir SVG</a>
                                    <a href="${url}" download="${id}.svg" target="_blank" class="btn-download">Télécharger SVG</a>
                                </div>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error('Erreur lors du chargement du sprite :', err);
                    document.getElementById('grid').innerHTML = `<p style="text-align:center; color:red; grid-column: 1/-1;">Erreur : ${err.message}.<br>Assurez-vous que cette page est servie via un serveur web (http://localhost...) et que le fichier sprite.svg est présent.</p>`;
                });
        });
    </script>
</body>
</html>
